---
description: 
globs: 
alwaysApply: true
---
---
description: Enforce BDD testing structure
globs: ["features/**/*.feature", "features/**/*.steps.ts", "features/**/*.steps.tsx"]
alwaysApply: true
---

- 每個 `.feature` 檔案都必須有對應的 `.steps.ts` 測試檔
- 使用 `jest-cucumber` 撰寫測試流程
- Step 定義必須包含 `given`, `when`, `then`
- 每個 `step` 使用明確變數命名（如 `username`, `password`, `result`）
- 測試需使用 `jest.fn()` 建立 mock function（例如 `mockLogin = jest.fn(login)`）
- 每個情境需驗證：
  - mock 函式是否被呼叫（`toHaveBeenCalledWith()`）
  - mock 函式是否只被呼叫一次（`toHaveBeenCalledTimes(1)`）
  - 回傳結果正確（`toBe(...)`）
- 每個測試檔應加入 `beforeEach()` 並清除 mock 狀態（`jest.clearAllMocks()`）
- 使用data-testid抓取控制項
- 至少包含：
  - 成功情境
  - 錯誤情境（帳密錯誤）
  - 邊界情境（空值）
